# Langflow Queue API

–°–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Langflow API.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

```bash
docker-compose up -d
```

### –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ Ollama

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –º–æ–¥–µ–ª—å:

```bash
docker exec -it ollama ollama pull llama3.2
```

## üìç –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **Ollama API**: http://localhost:11434/api/tags
- **Redis Commander**: http://localhost:8081
- **Queue API (Swagger)**: http://localhost:8000/docs
- **Langflow UI**: http://localhost:7860

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API

### 1. –°–æ–∑–¥–∞–Ω–∏–µ Flow –≤ Langflow

–°–æ–∑–¥–∞–π—Ç–µ flow —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Langflow (http://localhost:7860).

–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è flow: https://youtu.be/kFEMtax1yd4?si=ydRmbpzuJ0-S1jLJ

### 2. –ó–∞–ø—É—Å–∫ Flow —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å

–û—Ç–ø—Ä–∞–≤—å—Ç–µ POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/v1/build/{flow_id}/flow`:

```bash
POST /api/v1/build/{flow_id}/flow
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "inputs": {
    "input_value": "–ö–∞–∫–æ–≥–æ —Ü–≤–µ—Ç–∞ –∞–ø–µ–ª—å—Å–∏–Ω?"
  }
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "task_id": "abc-123-def-456",
  "status": "pending",
  "message": "enqueued: abc-123-def-456"
}
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `task_id` –∏–∑ –æ—Ç–≤–µ—Ç–∞.

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏

```bash
GET /get_task/{task_id}
```

–ò–∑ –æ—Ç–≤–µ—Ç–∞ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ `job_id` –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```bash
GET /api/v1/build/{job_id}/events
```

–≠—Ç–æ —Ç–∞–∫–∂–µ —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π `task_id` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

### 5. –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```bash
GET /parse_task_events/{task_id}
```

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON —Å —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏ –∏–∑ –æ—Ç–≤–µ—Ç–∞ Langflow.

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate  # Windows
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install -r requirements.local.txt
```

3. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

```bash
docker-compose stop queue-api  # –∏–ª–∏ worker
```

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ –æ—Ç–ª–∞–¥—á–∏–∫ (—Å–º. `.vscode/launch.json`)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ api/              # FastAPI —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ worker/           # –í–æ—Ä–∫–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á
‚îÇ   ‚îî‚îÄ‚îÄ langflow_queue/   # –û–±—â–∏–π –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—á–µ—Ä–µ–¥—è–º–∏
‚îú‚îÄ‚îÄ docker-compose.yml    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker Compose
‚îî‚îÄ‚îÄ requirements.local.txt  # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```

## üìù API Endpoints

### Langflow API (—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ)

- `POST /api/v1/build/{flow_id}/flow` - –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ flow
- `GET /api/v1/build/{job_id}/events` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### Internal API

- `GET /get_tasks` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–¥–∞—á
- `GET /get_task/{task_id}` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø–æ ID
- `GET /parse_task_events/{task_id}` - –†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–¥–∞—á–∏
- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### Queue API

- `REDIS_URL` - URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `redis://redis:6379/0`)
- `QUEUE_NAME` - –ò–º—è –æ—á–µ—Ä–µ–¥–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `langflow.queue`)
- `LANGFLOW_URL` - URL Langflow API (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `http://langflow:7860`)

### Worker

- `REDIS_URL` - URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis
- `LANGFLOW_URL` - URL Langflow API
- `QUEUE_NAME` - –ò–º—è –æ—á–µ—Ä–µ–¥–∏
- `WORKER_DEQUEUE_TIMEOUT` - –¢–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–¥–∞—á –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `5`)

## üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **Queue API** - FastAPI —Å–µ—Ä–≤–∏—Å, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π –∑–∞–ø—Ä–æ—Å—ã –∏ —Å—Ç–∞–≤—è—â–∏–π –∏—Ö –≤ –æ—á–µ—Ä–µ–¥—å
- **Worker** - –°–µ—Ä–≤–∏—Å, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–π –∑–∞–¥–∞—á–∏ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –∏ –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π –∑–∞–ø—Ä–æ—Å—ã –∫ Langflow
- **Redis** - –•—Ä–∞–Ω–∏–ª–∏—â–µ –æ—á–µ—Ä–µ–¥–µ–π –∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
- **Langflow** - –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è flow
- **Ollama** - LLM —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—è–º–∏

## üêõ –û—Ç–ª–∞–¥–∫–∞

- –õ–æ–≥–∏ –≤–æ—Ä–∫–µ—Ä–∞: `docker-compose logs -f worker`
- –õ–æ–≥–∏ API: `docker-compose logs -f queue-api`
- Redis Commander: http://localhost:8081 (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Redis)
