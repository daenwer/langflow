services:
  langflow-init:
    image: langflowai/langflow:1.6.5
    container_name: langflow-init
    user: "0:0"
    volumes:
      - ./data:/data
    command: >
      sh -lc 'mkdir -p /data && OWNER="$(stat -c %u /data 2>/dev/null || stat -f %u /data)" && [ "$OWNER" = "1000" ] || chown -R 1000:1000 /data'
    restart: "no"
    networks:
      - langflow-network

  langflow-app:
    image: langflowai/langflow:1.6.5
    container_name: langflow-app
    ports:
      - "7860:7860"
    env_file:
      - .env
    environment:
      - LANGFLOW_DATABASE_URL=${LANGFLOW_DATABASE_URL}
      - LANGFLOW_CONFIG_DIR=${LANGFLOW_CONFIG_DIR}
      - LANGFLOW_AUTH_DISABLED=${LANGFLOW_AUTH_DISABLED}
      - LANGFLOW_BACKEND_ONLY=${LANGFLOW_BACKEND_ONLY}
      - LANGFLOW_SKIP_AUTH_AUTO_LOGIN=${LANGFLOW_SKIP_AUTH_AUTO_LOGIN}
    volumes:
      - ./data:/data
    depends_on:
      - langflow-init
    networks:
      - langflow-network

networks:
  langflow-network:
    name: langflow-network
    driver: bridge
